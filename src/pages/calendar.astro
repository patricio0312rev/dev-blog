---
import BaseLayout from "@/layouts/BaseLayout.astro";
import ContentCalendarPage from "@/views/ContentCalendarPage";

interface PlanArticle {
  slug?: string;
  id?: string;
  entrySlug?: string;
  date?: string;
  scheduledDate?: string;
  title: string;
  description?: string;
  summary?: string;
  category: string;
  tags?: string[];
  status?: string;
}

interface ContentPlan {
  articles?: PlanArticle[];
  items?: PlanArticle[];
}

const planModules = import.meta.glob<{ default: ContentPlan }>(
  "/content-plans/*.json",
  { eager: true }
);

const allArticles = Object.values(planModules)
  .flatMap((mod) => {
    const data = mod.default || {};
    if (Array.isArray(data.articles)) return data.articles;
    if (Array.isArray(data.items)) return data.items;
    return [];
  })
  .map((article) => {
    const baseSlug: string = article.slug || article.id || "";
    const date: string = article.date || article.scheduledDate || "";

    const routeSlug: string = baseSlug || article.entrySlug || "";

    return {
      slug: routeSlug,
      title: article.title,
      description: article.description || article.summary || "",
      category: article.category,
      tags: article.tags || [],
      date,
      status: article.status || "planned",
    };
  })
  .filter((article) => !!article.date)
  .sort((a, b) => a.date.localeCompare(b.date));
---

<BaseLayout
  title="Content Calendar"
  description="See what's coming up on the blog."
>
  <ContentCalendarPage articles={allArticles} client:load />
</BaseLayout>
