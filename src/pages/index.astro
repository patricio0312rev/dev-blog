---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import HomePage from "@/views/HomePage";
import { normalizeDateInput } from "@/utils";

const articles = await getCollection("articles", ({ data }) => !data.draft);

const recentArticles = articles
  .sort(
    (a, b) =>
      normalizeDateInput(b.data.publishDate).getTime() -
      normalizeDateInput(a.data.publishDate).getTime()
  )
  .slice(0, 3)
  .map((article) => ({
    slug: article.slug,
    title: article.data.title,
    description: article.data.description,
    category: article.data.category,
    tags: article.data.tags,
    date: article.data.publishDate,
    heroImage: article.data.heroImage,
    heroImageAlt: article.data.heroImageAlt,
  }));
---

<BaseLayout title="Home">
  <HomePage articles={recentArticles} client:idle />
</BaseLayout>
